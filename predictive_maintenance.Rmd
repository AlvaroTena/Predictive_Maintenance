---
title: "predictive_maintenance.Rmd"
output: html_document
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(GGally)
library(tidyr)
```

# Load data

- **Telemetry Time Series Data** (PdM_telemetry.csv): It consists of hourly average of voltage, rotation, pressure, vibration collected from 100 machines for the year 2015.
- **Errors** (PdM_errors.csv): These are errors encountered by the machines while in operating condition. Since, these errors don't shut down the machines, these are not considered as failures. The error date and times are rounded to the closest hour since the telemetry data is collected at an hourly rate.
- **Maintenance** (PdM_maint.csv): If a component of a machine is replaced, that is captured as a record in this table. Components are replaced under two situations:
  - During the regular scheduled visit, the technician replaced it (Proactive Maintenance)
  - A component breaks down and then the technician does an unscheduled maintenance to replace the component (Reactive Maintenance). This is considered as a failure and corresponding data is captured under Failures. Maintenance data has both 2014 and 2015 records. This data is rounded to the closest hour since the telemetry data is collected at an hourly rate.
- **Failures** (PdM_failures.csv): Each record represents replacement of a component due to failure. This data is a subset of Maintenance data. This data is rounded to the closest hour since the telemetry data is collected at an hourly rate.
- **Metadata of Machines** (PdM_Machines.csv): Model type & age of the Machines.

```{r}
pdm_telemetry <- read_csv(
  "data/PdM_telemetry.csv",
  col_types = cols(
    datetime = col_datetime(format = "%Y-%m-%d %H:%M:%S"),
    machineID = col_integer(),
    volt = col_double(),
    rotate = col_double(),
    pressure = col_double(),
    vibration = col_double()
  )
)
pdm_errors <- read_csv(
  "data/PdM_errors.csv",
  col_types = cols(
    datetime = col_datetime(format = "%Y-%m-%d %H:%M:%S"),
    machineID = col_integer(),
    errorID = col_character()
  )
)
pdm_maint <- read_csv(
  "data/PdM_maint.csv",
  col_types = cols(
    datetime = col_datetime(format = "%Y-%m-%d %H:%M:%S"),
    machineID = col_integer(),
    comp = col_character()
  )
)
pdm_failures <- read_csv(
  "data/PdM_failures.csv",
  col_types = cols(
    datetime = col_datetime(format = "%Y-%m-%d %H:%M:%S"),
    machineID = col_integer(),
    failure = col_character()
  )
)
pdm_machines <- read_csv(
  "data/PdM_machines.csv",
  col_types = cols(
    machineID = col_integer(),
    model = col_character(),
    age = col_integer()
  )
)
```

```{r}
pdm_telemetry <- pdm_telemetry %>%
  arrange(datetime, machineID)

pdm_errors <- pdm_errors %>%
  arrange(datetime, machineID)

pdm_maint <- pdm_maint %>%
  arrange(datetime, machineID)

pdm_failures <- pdm_failures %>%
  arrange(datetime, machineID)
```

# EDA: Telemetry
```{r}
glimpse(pdm_telemetry)
head(pdm_telemetry)
```

### n_machines
```{r}
print("The number of unique machines in the pdm_telemetry dataset is:")
print(pdm_telemetry %>%
    distinct(machineID) %>%
    nrow()
)
```

### Data range
```{r}
date_range <- pdm_telemetry %>%
  summarize(
    min_datetime = min(datetime),
    max_datetime = max(datetime)
  )

print(paste(
  "Data is available in the date range from",
  date_range$min_datetime,
  "to",
  date_range$max_datetime
))
```
### Data Quality Check
```{r}
# Check for duplicates
if (any(duplicated(pdm_telemetry))) {
  cat("There are duplicates in the dataset.\n")
} else {
  cat("There are no duplicates in the dataset.\n")
}

# Check for missing values
if (any(is.na(pdm_telemetry))) {
  cat("There are missing values in the dataset.\n")
} else {
  cat("There are no missing values in the dataset.\n")
}
```

### Correlation and Distribution Scatterplot Matrix
```{r}
ggpairs(pdm_telemetry %>%
  select(volt, rotate, pressure, vibration))
```

### Visualize Machine 1 Sensor Data
```{r}
# Filter and select data for Machine 1
df_machine_1 <- pdm_telemetry %>%
  filter(machineID == 1) %>%
  select(datetime, volt, rotate, pressure, vibration)

# Reshape the data to long format
df_machine_1_long <- df_machine_1 %>%
  gather(variable, value, -datetime)

# Create a facetted line plot
ggplot(df_machine_1_long, aes(x = datetime, y = value, color = variable)) +
  geom_line(size = 1) +
  labs(title = "Variables for Machine 1", xlabel = "Time", ylabel = "Value") +
  facet_wrap(~variable, scales = "free_y", ncol = 1)
```

### Observations about Telemetry Data
- This may be synthetically generated data distributed between 1st Jan 2015 to 1st Jan 2016.
- Each row represents the state of a machine on a particular hour. Voltage, vibration, pressure & rotation of a machine have been averaged hourly.
- There are 100 unique Machines.
- There are no duplicates or missing values in the pdm_telemetry dataset.
- The four parameters voltage, vibration, pressure & rotation are normally distributed.
